name: 📈 Performance check (Lighthouse)
on: [push]
jobs:
    lighthouseci:
        env:
            LHCI_GITHUB_APP_TOKEN: ${{ secrets.LHCI_GITHUB_APP_TOKEN }}
        runs-on: ubuntu-latest
        steps:
            - name: 👍 Checkout
              uses: actions/checkout@v3

            - name: 🐢 Checkout Setup Node
              uses: actions/setup-node@v3
              with:
                  node-version: 20.11.0

            - name: 📥 Install Dependecies
              run: npm ci && npm install @rollup/rollup-linux-x64-gnu --save-optional && npm install -g @lhci/cli@0.14.x

            - name: 🏗️ Build App
              run: npm run build

            - name: 🏃 Run App
              run: npm run preview

            # - name: 📊 Run Lighthouse
            #   run: lhci autorun
            #   env:
            #       LHCI_GITHUB_APP_TOKEN: ${{ secrets.LHCI_GITHUB_APP_TOKEN }}

            - name: 👍 Checkout
              uses: actions/checkout@v4

            - name: 📊 Audit URLs using Lighthouse
              uses: treosh/lighthouse-ci-action@v12
              with:
                  urls: http://localhost:4173
                  uploadArtifacts: true # save results as an action artifacts
                  temporaryPublicStorage: true # upload lighthouse audits to google temporary storage
